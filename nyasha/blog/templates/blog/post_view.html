{% extends "blog/base.html" %}
{% load mptt_tags %}
{% block content %}
    <div id="content_header" class="span-15">
    {% with post.user.get_profile as user_profile %}
        {% include "blog/_user_info_short.html" %}
    {% endwith %}
    </div>
    {% include "blog/_post_piece.html" %}
    <div>
        {% if recommends %}
            {{ _("recommends")|capfirst }}: {% for r in recommends %}
                <a href="{% url user_blog r.user.username %}">@{{ user.username }}</a>{% if not forloop.last %}, {% endif %}
            {% endfor %}
        {% endif %}
    </div>
    <h2 class="span-4">{{ _("Replies")|capfirst }} ({{ post.comments_count }})</h2>
    <div id="toggle_mode" class="prepend-9 span-1 last">
    <form method="get" action="">
        <input type="hidden" name="tree" value="{% if not is_tree %}1{% endif %}"/>
        <button>{% if not is_tree %}{{ _("tree")|capfirst }}{% else %}{{ _("linear")|capfirst }}{% endif %}</button>
    </form>
    </div>
    <div id="comments_wrap" class="span-15">
    {% if is_tree %}
        {% for comment, structure in comments|tree_info %}
            {% if structure.new_level %}<ul><li>{% else %}</li><li>{% endif %}
                {% include "blog/_comment_piece.html" %}
            {% for level in structure.closed_levels %}</li></ul>{% endfor %}
        {% endfor %}
    {% else %}
        <ul>
        {% for comment in comments %}
            <li>
                {% include "blog/_comment_piece.html" %}
            </li>
        {% endfor %}
        </ul>
    {% endif %}
    </div>

        
{% endblock content %}

{% block right_sidebar %}
    {% if user_blog %}
    <div class="sidebar_wrapper">
         {% include "blog/_user_blog_sidebar.html" %}
    </div>
    {% endif %}
    <div class="sidebar_wrapper">
        {% include "blog/_tags_cloud.html" %}
    </div>
{% endblock right_sidebar %}
